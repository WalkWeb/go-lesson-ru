
# Изучаем язык Go #18 – Строки и руны

***«Простой» текст на экране компьютера на самом деле намного сложнее, чем просто текст, по этому с пониманием этого
урока могут возникнуть сложности. Можно пропустить его и вернуться потом***

Строка в Go – это [срез](https://github.com/WalkWeb/go-lesson-ru/tree/master/9_slices) байтов доступный только для 
чтения. Обычно в языках программирования символы строки называют `character`, в Go же их приятно называть рунами 
`runes`.

В этом уроке мы рассмотрим работу со строками более подробно.

Создадим константу, в которую запишем строку, состоящую из символов тайского языка, в переводе обозначающие «привет»:

```
    const s = "สวัสดี"
```

Строка анологична срезу из байтов `[]byte` и мы можем узнать её размер с помощью функции `len()`:

```
    fmt.Println("Len:", len(s)) // 18 байтов
```

А можем посмотреть из чего состоит каждый из элементов такого среза:

```
    for i := 0; i < len(s); i++ {
        fmt.Printf("%x ", s[i])
    }
    fmt.Println()
```

Выполнив этот код мы получим:

```
e0 b8 aa e0 b8 a7 e0 b8 b1 e0 b8 aa e0 b8 94 e0 b8 b5
```

Все это числа в шестнадцатеричной счетной системе, которые в свою очередь являются стандартным вариантом отображения
битов (запись вида 010010110... будет слишком длинной).

Каждый символ в шестнадцатеричной счетной системе – это 4 бита. Соответственно в данном случае мы видим 36 числа, 
умножаем на 4 получаем 144 бита. А байт состоит из 8 битов, соответственно 144 / 8 = 18 байтов. Что нам и вернул 
`len()`.

Чтобы наконец-то отойти от байтов, и перейти к символам, из которых, с точки человека, состоит строка, нужно 
воспользоваться библиотекой `unicode/utf8`:

```
    fmt.Println("Rune count:", utf8.RuneCountInString(s))

    for index, runeValue := range s {
        fmt.Printf("%#U starts at %d\n", runeValue, index)
    }
    fmt.Println()
```

Выполнив этот код получим:

```
$ go run strings-and-runes.go 
// ...
Rune count: 6
U+0E2A 'ส' starts at 0
U+0E27 'ว' starts at 3
U+0E31 'ั' starts at 6
U+0E2A 'ส' starts at 9
U+0E14 'ด' starts at 12
U+0E35 'ี' starts at 15
```

Количество рун: 6, и идет их перечисление. Логичный вопрос – почему в строке мы видим 4 символа, а `unicode/utf8`
говорит, что рун 6. Все дело в том, что некоторые тайские символы представлены несколькими символами из UTF-8.

В случае с `สวัสด`, которая на самом деле состоит из 6 символов, каждый из них занимает по 3 байта. Но вообще разные
символы UTF-8 могут занимать разное количество байт (от 1 до 4), по этому для декорирования такого набора бит программа
проходит по ним и поочередно декодирует каждый в какой-то символ. Потом делает сдвиг на то количество битов, которое
занимал предыдущий символ, и декодирует следующий.

Посмотреть это наглядно можно следующим образом:

```
    fmt.Println("Using DecodeRuneIsString")

    for i, w := 0, 0; i < len(s); i += w {
        runeValue, width := utf8.DecodeRuneInString(s[i:])
        fmt.Printf("%#U starts at %d\n", runeValue, i)
        w = width

        examineRune(runeValue)
    }
```

И сама функция `examineRune`:

```
func examineRune(r rune) {
    if r == 't' {
        fmt.Println("found tee")
    } else if r == 'ส'  {
        fmt.Println("found so sua")
    }
}
```

Выполнив этот код получим:

```
$ go run strings-and-runes.go 
// ...
Using DecodeRuneIsString
U+0E2A 'ส' starts at 0
found so sua
U+0E27 'ว' starts at 3
U+0E31 'ั' starts at 6
U+0E2A 'ส' starts at 9
found so sua
U+0E14 'ด' starts at 12
U+0E35 'ี' starts at 15
```
____

В этом уроке вы узнали:

1. Что на самом деле представляет из себя строка в Go, что такое руны
2. Как узнать размер строки в байтах
3. Как узнать количество рун в строке
4. Познакомились с библиотекой `unicode/utf8`
